version: 2

models:
  - name: gmx_v2_avalanche_c_PositionIncrease
    meta:
      blockchain: avalanche_c
      sector: dex
      project: gmx
      contributors: ai_data_master
    config:
      tags: ['avalanche_c','gmx','event','position_increase']
    description: |
      This model extracts and parses `PositionIncrease` events from the Avalanche blockchain.
      It includes transaction details, addresses, and various metrics related to the event, 
      such as market data, collateral amounts, price impacts, and more.

    columns:
      - &blockchain
        name: blockchain
        description: The blockchain network where the event occurred (Avalanche)
        tests:
          - not_null
      - &block_time
        name: block_time
        description: The timestamp of the block when the event was recorded
        tests:
          - not_null
      - &block_date
        name: block_date
        description: The date of the block when the event was recorded
        tests:
          - not_null
      - &block_number
        name: block_number
        description: The block number where the event is included
        tests:
          - not_null
      - &tx_hash
        name: tx_hash
        description: The hash of the transaction where the event was logged
        tests:
          - not_null
      - &index
        name: index
        description: The position of the event within the transaction
        tests:
          - not_null
      - &tx_index
        name: tx_index
        description: The position of the transaction within the block
        tests:
          - not_null
      - &tx_from
        name: tx_from
        description: The address initiating the transaction
        tests:
          - not_null
      - &tx_to
        name: tx_to
        description: The address receiving the transaction
        tests:
          - not_null
      - &contract_address
        name: contract_address
        description: The contract address associated with the event
        tests:
          - not_null
      - &account
        name: account
        description: The trader's account
        tests:
          - not_null
      - name: event_name
        description: The type of event recorded, always 'PositionIncrease' for this model
        tests:
          - not_null    
      - name: market
        description: The market associated with the position increase
        tests:
          - not_null
      - name: collateral_token
        description: The collateral token used in the position increase
        tests:
          - not_null
      - &collateral_token_symbol
        name: collateral_token_symbol
        description: The symbol of the token used as collateral in the market. This token represents the asset that backs the position and is used to secure trades.
        tests:
          - not_null
      - &market_name
        name: market_name
        description: |
          The name of the market within the GMX protocol, formatted as a combination of the index token and the long/short tokens. 
          The format is `index_token_symbol/USD [long_token_symbol-short_token_symbol]`, which represents the trading pair and the associated positions within the market.
      - &size_in_usd
        name: size_in_usd
        description: The size of the position in USD
        tests:
          - not_null
      - &size_in_tokens
        name: size_in_tokens
        description: The size of the position in index tokens
        tests:
          - not_null
      - name: collateral_amount
        description: The amount of collateral in the position after it was increased
        tests:
          - not_null
      - &borrowing_factor
        name: borrowing_factor
        description: The cumulative borrowing factor applied to the position over time
        tests:
          - not_null
      - &funding_fee_amount_per_size
        name: funding_fee_amount_per_size
        description: The cumulative funding fee amount per size
        tests:
          - not_null
      - &long_token_claimable_funding_amount_per_size
        name: long_token_claimable_funding_amount_per_size
        description: The cumulative claimable funding amount per size for long tokens
        tests:
          - not_null
      - &short_token_claimable_funding_amount_per_size
        name: short_token_claimable_funding_amount_per_size
        description: The cumulative claimable funding amount per size for short tokens
        tests:
          - not_null
      - &execution_price
        name: execution_price
        description: The execution price of the position after price impact
        tests:
          - not_null
      - &index_token_price_max
        name: index_token_price_max
        description: The maximum price of the index token during the event
        tests:
          - not_null
      - &index_token_price_min
        name: index_token_price_min
        description: The minimum price of the index token during the event
        tests:
          - not_null
      - &collateral_token_price_max
        name: collateral_token_price_max
        description: The maximum price of the collateral token during the event
        tests:
          - not_null
      - &collateral_token_price_min
        name: collateral_token_price_min
        description: The minimum price of the collateral token during the event
        tests:
          - not_null
      - &size_delta_usd
        name: size_delta_usd
        description: The change in position size in USD
        tests:
          - not_null
      - &size_delta_in_tokens
        name: size_delta_in_tokens
        description: The change in position size in tokens
        tests:
          - not_null
      - &order_type
        name: order_type
        description: The type of order executed. The following table describes each order type:
          | Order Type       | Description                                                                                           |
          |------------------|-------------------------------------------------------------------------------------------------------|
          | MarketSwap       | Swap token A to token B at the current market price. The order will be cancelled if the minOutputAmount cannot be fulfilled. |
          | LimitSwap        | Swap token A to token B if the minOutputAmount can be fulfilled.                                     |
          | MarketIncrease   | Increase position at the current market price. The order will be cancelled if the position cannot be increased at the acceptablePrice. |
          | LimitIncrease    | Increase position if the triggerPrice is reached and the acceptablePrice can be fulfilled.           |
          | MarketDecrease   | Decrease position at the current market price. The order will be cancelled if the position cannot be decreased at the acceptablePrice. |
          | LimitDecrease    | Decrease position if the triggerPrice is reached and the acceptablePrice can be fulfilled.           |
          | StopLossDecrease | Decrease position if the triggerPrice is reached and the acceptablePrice can be fulfilled.           |
          | Liquidation      | Allows liquidation of positions if the criteria for liquidation are met.                             |
        tests:
          - not_null
      - name: increased_at_time
        description: The block timestamp when the position was increased
      - &collateral_delta_amount
        name: collateral_delta_amount
        description: The change in collateral amount
        tests:
          - not_null
      - &price_impact_usd
        name: price_impact_usd
        description: The impact on price in USD
        tests:
          - not_null
      - &price_impact_amount
        name: price_impact_amount
        description: The impact on price in index token amount
        tests:
          - not_null
      - &is_long
        name: is_long
        description: A boolean indicating whether the position is long
        tests:
          - not_null
      - &order_key
        name: order_key
        description: A unique key identifying the order
        tests:
          - not_null
      - &position_key
        name: position_key
        description: A unique key identifying the position
        tests:
          - not_null


  - name: gmx_v2_avalanche_c_PositionDecrease
    meta:
      blockchain: avalanche_c
      sector: dex
      project: gmx
      contributors: ai_data_master
    config:
      tags: ['avalanche_c','gmx','event','position_decrease']
    description: |
      This model extracts and parses `PositionDecrease` events from the Avalanche blockchain.
      It includes transaction details, addresses, and various metrics related to the event, 
      such as market data, collateral amounts, price impacts, and more.

    columns:
      - *blockchain
      - *block_time
      - *block_date
      - *block_number
      - *tx_hash
      - *index
      - *tx_index
      - *tx_from
      - *tx_to
      - *contract_address
      - *account
      - name: event_name
        description: The type of event recorded, always 'PositionDecrease' for this model
        tests:
          - not_null  
      - name: market
        description: The market associated with the position decrease
        tests:
          - not_null
      - name: collateral_token
        description: The collateral token used in the position decrease
        tests:
          - not_null
      - *collateral_token_symbol
      - *market_name
      - *size_in_usd
      - *size_in_tokens
      - name: collateral_amount
        description: The amount of collateral in the position after it was decreased
        tests:
          - not_null
      - *borrowing_factor
      - *funding_fee_amount_per_size
      - *long_token_claimable_funding_amount_per_size
      - *short_token_claimable_funding_amount_per_size
      - *execution_price
      - *index_token_price_max
      - *index_token_price_min
      - *collateral_token_price_max
      - *collateral_token_price_min
      - *size_delta_usd
      - *size_delta_in_tokens
      - *collateral_delta_amount
      - &impact_diff_usd
        name: impact_diff_usd
        description: The difference in price impact in USD compared to a baseline or previous value, considering the maximum price impact limit
        tests:
          - not_null       
      - *order_type 
      - &decreased_at_time
        name: decreased_at_time
        description: The block timestamp when the position was decreased             
      - *price_impact_usd
      - &base_pnl_usd
        name: base_pnl_usd
        description: The base profit and loss in USD for the position
        tests:
          - not_null
      - &uncapped_base_pnl_usd
        name: uncapped_base_pnl_usd
        description: The uncapped base profit and loss in USD, without any limits or caps applied
        tests:
          - not_null      
      - *is_long
      - *order_key
      - *position_key


  - name: gmx_v2_avalanche_c_MarketCreated
    meta:
      blockchain: avalanche_c
      sector: dex
      project: gmx
      contributors: ai_data_master
    config:
      tags: ['avalanche_c', 'gmx', 'event', 'market_created']
    description: |
      This model extracts and parses `MarketCreated` events from the Avalanche blockchain.
      It includes transaction details, addresses, and other relevant metrics related to 
      the creation of markets within the GMX protocol.

    columns:
      - *blockchain
      - *block_time
      - *block_date
      - *block_number
      - *tx_hash
      - *index
      - *tx_index
      - *tx_from
      - *tx_to
      - *contract_address
      - name: account
        description: The account related to the event
        tests:
          - not_null
      - name: event_name
        description: The type of event recorded, always 'MarketCreated' for this model
        tests:
          - not_null 
      - &market_token
        name: market_token
        description: The token used to represent the market
        tests:
          - not_null
      - &index_token
        name: index_token
        description: The token used as the index in the market
        tests:
          - not_null
      - &long_token
        name: long_token
        description: The token used for long positions in the market
        tests:
          - not_null
      - &short_token
        name: short_token
        description: The token used for short positions in the market
        tests:
          - not_null
      - &salt
        name: salt
        description: A unique value used to prevent hash collisions
        tests:
          - not_null
      - &spot_only
        name: spot_only
        description: Indicates if the market is spot-only (true when index_token is the zero address)
        tests:
          - not_null          
      - &market_token_symbol
        name: market_token_symbol
        description: The symbol of the market token (hardcoded as 'GM' in this model)  
        tests:
          - not_null    
      - &market_token_decimals
        name: market_token_decimals
        description: The decimal precision of the market token (hardcoded as 18 in this model)          
        tests:
          - not_null      
      - &index_token_symbol
        name: index_token_symbol
        description: The symbol of the index token                
      - &index_token_decimals
        name: index_token_decimals
        description: The decimal precision of the index token              
      - &long_token_symbol
        name: long_token_symbol
        description: The symbol of the long token       
        tests:
          - not_null             
      - &long_token_decimals
        name: long_token_decimals
        description: The decimal precision of the long token  
        tests:
          - not_null                 
      - &short_token_symbol
        name: short_token_symbol
        description: The symbol of the short token    
        tests:
          - not_null               
      - &short_token_decimals
        name: short_token_decimals
        description: The decimal precision of the short token  
        tests:
          - not_null    