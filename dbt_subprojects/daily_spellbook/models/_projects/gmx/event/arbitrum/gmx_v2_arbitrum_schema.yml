version: 2

models:
  - name: gmx_v2_arbitrum_PositionIncrease
    meta:
      blockchain: arbitrum
      sector: dex
      project: gmx
      contributors: ai_data_master
    config:
      tags: ['arbitrum','gmx','event','position_increase']
    description: |
      This model extracts and parses `PositionIncrease` events from the Arbitrum blockchain.
      It includes transaction details, addresses, and various metrics related to the event, 
      such as market data, collateral amounts, price impacts, and more.

    columns:
      - &blockchain
        name: blockchain
        description: The blockchain network where the event occurred (Arbitrum)
        tests:
          - not_null
      - &block_time
        name: block_time
        description: The timestamp of the block when the event was recorded
        tests:
          - not_null
      - &block_date
        name: block_date
        description: The date of the block when the event was recorded
        tests:
          - not_null
      - &block_number
        name: block_number
        description: The block number where the event is included
        tests:
          - not_null
      - &tx_hash
        name: tx_hash
        description: The hash of the transaction where the event was logged
        tests:
          - not_null
      - &index
        name: index
        description: The position of the event within the transaction
        tests:
          - not_null
      - &tx_index
        name: tx_index
        description: The position of the transaction within the block
        tests:
          - not_null
      - &tx_from
        name: tx_from
        description: The address initiating the transaction
        tests:
          - not_null
      - &tx_to
        name: tx_to
        description: The address receiving the transaction
        tests:
          - not_null
      - &contract_address
        name: contract_address
        description: The contract address associated with the event
        tests:
          - not_null
      - &account
        name: account
        description: The account related to the event, extracted from the `topic2` field
        tests:
          - not_null
      - &event_name
        name: event_name
        description: The type of event recorded, always 'PositionIncrease' for this model
        tests:
          - not_null    
      - &market
        name: market
        description: The market identifier associated with the position increase
        tests:
          - not_null
      - &collateral_token
        name: collateral_token
        description: The collateral token used in the position increase
        tests:
          - not_null
      - &size_in_usd
        name: size_in_usd
        description: The size of the position in USD
        tests:
          - not_null
      - &size_in_tokens
        name: size_in_tokens
        description: The size of the position in tokens
        tests:
          - not_null
      - &collateral_amount
        name: collateral_amount
        description: The amount of collateral used
        tests:
          - not_null
      - &borrowing_factor
        name: borrowing_factor
        description: The borrowing factor applied to the position
        tests:
          - not_null
      - &funding_fee_amount_per_size
        name: funding_fee_amount_per_size
        description: The funding fee amount per size
        tests:
          - not_null
      - &long_token_claimable_funding_amount_per_size
        name: long_token_claimable_funding_amount_per_size
        description: The claimable funding amount per size for long tokens
        tests:
          - not_null
      - &short_token_claimable_funding_amount_per_size
        name: short_token_claimable_funding_amount_per_size
        description: The claimable funding amount per size for short tokens
        tests:
          - not_null
      - &execution_price
        name: execution_price
        description: The execution price of the position
        tests:
          - not_null
      - &index_token_price_max
        name: index_token_price_max
        description: The maximum price of the index token during the event
        tests:
          - not_null
      - &index_token_price_min
        name: index_token_price_min
        description: The minimum price of the index token during the event
        tests:
          - not_null
      - &collateral_token_price_max
        name: collateral_token_price_max
        description: The maximum price of the collateral token during the event
        tests:
          - not_null
      - &collateral_token_price_min
        name: collateral_token_price_min
        description: The minimum price of the collateral token during the event
        tests:
          - not_null
      - &size_delta_usd
        name: size_delta_usd
        description: The change in position size in USD
        tests:
          - not_null
      - &size_delta_in_tokens
        name: size_delta_in_tokens
        description: The change in position size in tokens
        tests:
          - not_null
      - &order_type
        name: order_type
        description: The type of order executed
        tests:
          - not_null
      - &increased_at_time
        name: increased_at_time
        description: The Unix timestamp when the position was increased
      - &collateral_delta_amount
        name: collateral_delta_amount
        description: The change in collateral amount
        tests:
          - not_null
      - &price_impact_usd
        name: price_impact_usd
        description: The impact on price in USD
        tests:
          - not_null
      - &price_impact_amount
        name: price_impact_amount
        description: The impact on price in token amount
        tests:
          - not_null
      - &is_long
        name: is_long
        description: A boolean indicating whether the position is long
        tests:
          - not_null
      - &order_key
        name: order_key
        description: A unique key identifying the order
        tests:
          - not_null
      - &position_key
        name: position_key
        description: A unique key identifying the position
        tests:
          - not_null

  - name: gmx_v2_arbitrum_PositionDecrease
    meta:
      blockchain: arbitrum
      sector: dex
      project: gmx
      contributors: ai_data_master
    config:
      tags: ['arbitrum','gmx','event','position_decrease']
    description: |
      This model extracts and parses `PositionDecrease` events from the Arbitrum blockchain.
      It includes transaction details, addresses, and various metrics related to the event, 
      such as market data, collateral amounts, price impacts, and more.

    columns:
      - *blockchain
      - *block_time
      - *block_date
      - *block_number
      - *tx_hash
      - *index
      - *tx_index
      - *tx_from
      - *tx_to
      - *contract_address
      - *account
      - *event_name
      - *market
      - *collateral_token
      - *size_in_usd
      - *size_in_tokens
      - *collateral_amount
      - *borrowing_factor
      - *funding_fee_amount_per_size
      - *long_token_claimable_funding_amount_per_size
      - *short_token_claimable_funding_amount_per_size
      - *execution_price
      - *index_token_price_max
      - *index_token_price_min
      - *collateral_token_price_max
      - *collateral_token_price_min
      - *size_delta_usd
      - *size_delta_in_tokens
      - *collateral_delta_amount
      - *order_type 
      - *price_impact_usd
      - *is_long
      - *order_key
      - *position_key

      - &values_price_impact_diff_usd
        name: values_price_impact_diff_usd
        description: The difference in price impact in USD compared to a baseline or previous value
        tests:
          - not_null  
      - &decreased_at_time
        name: decreased_at_time
        description: The Unix timestamp when the position was decreased
      - &base_pnl_usd
        name: base_pnl_usd
        description: The base profit and loss in USD for the position
        tests:
          - not_null
      - &uncapped_base_pnl_usd
        name: uncapped_base_pnl_usd
        description: The uncapped base profit and loss in USD, without any limits or caps applied
        tests:
          - not_null


  - name: gmx_v2_arbitrum_MarketCreated
    meta:
      blockchain: arbitrum
      sector: dex
      project: gmx
      contributors: ai_data_master
    config:
      tags: ['arbitrum', 'gmx', 'event', 'market_created']
    description: |
      This model extracts and parses `MarketCreated` events from the Arbitrum blockchain.
      It includes transaction details, addresses, and other relevant metrics related to 
      the creation of markets within the GMX protocol.

    columns:
      - *blockchain
      - *block_time
      - *block_date
      - *block_number
      - *tx_hash
      - *index
      - *tx_index
      - *tx_from
      - *tx_to
      - *contract_address
      - *account
      - *event_name

      - &market_token
        name: market_token
        description: The token used to represent the market
        tests:
          - not_null
      - &index_token
        name: index_token
        description: The token used as the index in the market
        tests:
          - not_null
      - &long_token
        name: long_token
        description: The token used for long positions in the market
        tests:
          - not_null
      - &short_token
        name: short_token
        description: The token used for short positions in the market
        tests:
          - not_null
      - &salt
        name: salt
        description: A unique value used to prevent hash collisions
        tests:
          - not_null
        &spot_only
      - name: spot_only
        description: Indicates if the market is spot-only (true when index_token is the zero address)
        tests:
          - not_null          
      - &market_token_symbol
        name: market_token_symbol
        description: The symbol of the market token (hardcoded as 'GM' in this model)  
        tests:
          - not_null    
      - &market_token_decimals
        name: market_token_decimals
        description: The decimal precision of the market token (hardcoded as 18 in this model)          
        tests:
          - not_null      
      - &index_token_symbol
        name: index_token_symbol
        description: The symbol of the index token 
        tests:
          - not_null:
              condition: "{{ index_token != '0x0000000000000000000000000000000000000000' }}"                 
      - &index_token_decimals
        name: index_token_decimals
        description: The decimal precision of the index token 
        tests:
          - not_null:
              condition: "{{ index_token != '0x0000000000000000000000000000000000000000' }}"              
      - &long_token_symbol
        name: long_token_symbol
        description: The symbol of the long token       
        tests:
          - not_null             
      - &long_token_decimals
        name: long_token_decimals
        description: The decimal precision of the long token  
        tests:
          - not_null                 
      - &short_token_symbol
        name: short_token_symbol
        description: The symbol of the short token    
        tests:
          - not_null               
      - &short_token_decimals
        name: short_token_decimals
        description: The decimal precision of the short token  
        tests:
          - not_null                   
        
